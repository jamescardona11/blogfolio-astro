---
import { getCollection, type CollectionEntry } from 'astro:content'

// import ListLayout from "@/layouts/ListLayout.astro";
import { ITEMS_PER_PAGE } from '@/consts'
import type { Page } from 'astro'
import { excludeDrafts, sortPosts } from '@/lib/data/local/mdx-posts-functions'
import ListWithTagsLayout from '@/layouts/old/ListWithTagsLayout.astro'

interface Props {
  page: Page<CollectionEntry<'posts'>>
  entry: CollectionEntry<'tags'>
}

// @ts-ignore
export async function getStaticPaths({ paginate }) {
  const tags = await getCollection('tags')
  const posts = await getCollection('posts', excludeDrafts).then(sortPosts)

  return tags.flatMap(entry => {
    const tagPosts = posts.filter(post =>
      post.data.tags.some(({ slug }) => slug === entry.slug)
    )
    return paginate(tagPosts, {
      pageSize: ITEMS_PER_PAGE,
      params: { slug: entry.slug },
      props: { entry }
    })
  })
}

const { page, entry } = Astro.props
const { Content } = await entry.render()
---

<!--<ListLayout title={entry.data.name} description={entry.data.description} page={page}>--><!--    <Content/>--><!--</ListLayout>-->
<ListWithTagsLayout
  title={entry.data.name}
  description={entry.data.description}
  page={page}
>
  <Content />
</ListWithTagsLayout>
 @/lib/data/local/mdx-posts-functions
