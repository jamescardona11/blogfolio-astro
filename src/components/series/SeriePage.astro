---
import { slug as slugger } from 'github-slugger'
import type { SeriesWithPosts } from '@/content/post-serie.type'
import Link from '@/components/Link.astro'

import PostsListView from '@/components/PostsListView.astro'
import BaseCard from '@/components/BaseCard.astro'

interface Props {
  serieWithPosts: SeriesWithPosts
  isFirst?: boolean
}

const { serieWithPosts, isFirst = false } = Astro.props

function isSamePath(path: string) {
  return Astro.url.pathname === path
}
---

<div>
  <div class='pb-6 pt-6'>
    <h1
      class='text-3xl capitalize font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:leading-10 md:leading-14'
    >
      {serieWithPosts.serie}
    </h1>
  </div>

  <div class='flex md:flex-row flex-col sm:space-x-4 items-start'>
    <BaseCard styles='sm:min-w-full md:min-w-[320px]'>
      <div class='py-4'>
        <h3 class='text-primary font-bold uppercase'>All Series</h3>

        <ul>
          {
            Array.from(serieWithPosts.series.entries()).map((key, index) => {
              const serie = key[0]
              const count = key[1]

              const slug = slugger(serie)

              return (
                <Fragment>
                  <li class='my-3'>
                    {isSamePath(`/series/${slug}`) ||
                    (index == 0 && isFirst) ? (
                      <Fragment>
                        <h3 class='inline py-2 px-3 capitalize text-sm font-bold text-primary-500 underline'>
                          {`${serie} (${count})`}
                        </h3>
                      </Fragment>
                    ) : (
                      <Fragment>
                        <Link
                          href={`/series/${slug}`}
                          class='py-2 px-3 capitalize text-sm font-medium text-gray-500 dark:text-gray-300 hover:text-primary-500 dark:hover:text-primary-500'
                          {...{ 'aria-label': `View serie ${serie}` }}
                        >
                          {`${serie} (${count})`}
                        </Link>
                      </Fragment>
                    )}
                  </li>
                </Fragment>
              )
            })
          }
        </ul>
      </div>
    </BaseCard>
    <PostsListView posts={serieWithPosts.posts} />
  </div>
</div>
