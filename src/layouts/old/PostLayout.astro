---
import FormattedDate from '@/components/for-pages/blog/FormattedDate.astro'
import ScrollTopAndComments from '@/components/old/ScrollTopAndComments.astro'
import Tag from '@/components/old/Tag.astro'
import { Link } from '@radix-ui/react-navigation-menu'
import { Image } from 'astro:assets'
import { type CollectionEntry, getEntries } from 'astro:content'
import SectionContainer from '../SectionContainer.astro'
import RootLayout from '../root/RootLayout.astro'

interface Props {
  post: CollectionEntry<'blog'>
  next?: CollectionEntry<'blog'>
  prev?: CollectionEntry<'blog'>
}

const { post, next, prev } = Astro.props as Props
const authors: CollectionEntry<'authors'>[] = await getEntries(
  post.data.authors
)
const tags: CollectionEntry<'tags'> = await getEntries(post.data.tags)
const related: CollectionEntry<'blog'>[] = await getEntries(post.data.related)

// TODO: Later add support for headings and remarkPluginFrontmatter
const { Content, headings, remarkPluginFrontmatter } = await post.render()
---

<RootLayout metaTitle={post.data.title} metaDescription={post.data.summary}>
  <SectionContainer>
    <!-- <ScrollTopAndComments /> -->
    <article>
      <div class='xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700'>
        <header class='pt-6 xl:pb-6'>
          <div class='space-y-1 text-center'>
            <dl class='space-y-10'>
              <div>
                <dt class='sr-only'>Published on</dt>
                <dd
                  class='text-base font-medium leading-6 text-gray-500 dark:text-gray-400'
                >
                  <FormattedDate date={post.data.date} />
                </dd>
              </div>
            </dl>
            <div>
              <h1
                class='text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14'
              >
                {post.data.title}
              </h1>
            </div>
          </div>
        </header>
        <div
          class='grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0'
        >
          <dl
            class='pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700'
          >
            <dt class='sr-only'>Authors</dt>
            <dd>
              <ul
                class='flex flex-wrap justify-center items-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8'
              >
                <!--TODO: Add support for multiple authors-->
                {
                  authors.map(({ data, slug }) => (
                    <>
                      <li class='flex items-center space-x-2'>
                        {data.avatar && (
                          <Image
                            src={data.avatar}
                            width={38}
                            height={38}
                            alt='avatar'
                            class='h-10 w-10 rounded-full'
                          />
                        )}
                        <dl class='whitespace-nowrap text-sm font-medium leading-5'>
                          <dt class='sr-only'>Name</dt>
                          <dd class='text-gray-900 dark:text-gray-100'>
                            {data.name}
                          </dd>
                          <dt class='sr-only'>Twitter</dt>
                          <dd>
                            {data.twitter && (
                              <Link href={data.twitter}>
                                {data.twitter.replace(
                                  'https://twitter.com/',
                                  '@'
                                )}
                              </Link>
                            )}
                          </dd>
                        </dl>
                      </li>
                      <li>
                        <span class='text-gray-500 dark:text-gray-400'>
                          {data.occupation && data.company
                            ? `${data.occupation} at ${data.company}`
                            : data.company}
                        </span>
                      </li>
                    </>
                  ))
                }
              </ul>
            </dd>
          </dl>
          <div
            class='divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0'
          >
            <div class='prose max-w-none pb-8 pt-10 dark:prose-invert'>
              <slot />
              <Content />
            </div>
            <!--    <div class="pb-6 pt-6 text-sm text-gray-700 dark:text-gray-300">-->
            <!--        <Link href={discussUrl(path)} rel="nofollow">-->
            <!--            Discuss on Twitter-->
            <!--        </Link>-->
            <!--        {` â€¢ `}-->
            <!--        <Link href={editUrl(filePath)}>View on GitHub</Link>-->
            <!--    </div>-->
            <!--    {SITE_METADATA.comments && (-->
            <!--            <div-->
            <!--                    class="pb-6 pt-6 text-center text-gray-700 dark:text-gray-300"-->
            <!--                    id="comment"-->
            <!--            >-->
            <!--                <Comments slug={slug}/>-->
            <!--            </div>-->
            <!--    )}-->
          </div>
          <footer>
            <div
              class='divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y'
            >
              {
                tags && (
                  <div class='py-4 xl:py-8'>
                    <h2 class='text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400'>
                      Tags
                    </h2>
                    <div class='flex flex-wrap'>
                      {tags.map(tag => (
                        <Tag tag={tag} />
                      ))}
                    </div>
                  </div>
                )
              }
              {
                (next || prev) && (
                  <div class='flex justify-between py-4 xl:block xl:space-y-8 xl:py-8'>
                    {prev && (
                      <div>
                        <h2 class='text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400'>
                          Previous Article
                        </h2>
                        <div class='text-primary-500 hover:text-primary-600 dark:hover:text-primary-400'>
                          <Link href={`/blog/${prev.slug}`}>
                            {prev.data.title}
                          </Link>
                        </div>
                      </div>
                    )}
                    {next && (
                      <div>
                        <h2 class='text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400'>
                          Next Article
                        </h2>
                        <div class='text-primary-500 hover:text-primary-600 dark:hover:text-primary-400'>
                          <Link href={`/blog/${next.slug}`}>
                            {next.data.title}
                          </Link>
                        </div>
                      </div>
                    )}
                  </div>
                )
              }
              {
                related.length > 0 && (
                  <div class='py-4 xl:pb-8'>
                    <h2 class='text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400'>
                      Related Articles
                    </h2>
                    <ul class='flex flex-wrap gap-2 xl:space-x-0 xl:space-y-0'>
                      {related.map(post => (
                        <li class='text-primary-500 hover:text-primary-600 dark:hover:text-primary-400'>
                          <Link href={`/blog/${post.slug}`}>
                            {post.data.title}
                          </Link>
                        </li>
                      ))}
                    </ul>
                  </div>
                )
              }
            </div>
            <div class='pt-4 xl:pt-8'>
              <Link href='/blog' aria-label='Back to the blog'>
                &larr; Back to the blog
              </Link>
            </div>
          </footer>
        </div>
      </div>
    </article>
  </SectionContainer>
</RootLayout>
